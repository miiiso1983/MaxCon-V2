@extends('layouts.tenant')

@section('title', 'ุงุฎุชุจุงุฑ QR ููุฏ ุณูุฏ ุงูุงุณุชูุงู')

@section('content')
<div class="w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 main-container">
    <!-- Header Section -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
        <div class="px-6 py-4 border-b border-gray-200 header-padding">
            <h1 class="text-2xl font-bold text-gray-900 mb-2">ุงุฎุชุจุงุฑ QR ููุฏ ุณูุฏ ุงูุงุณุชูุงู</h1>
            <p class="text-gray-600">ูุฐู ุงูุตูุญุฉ ูุงุฎุชุจุงุฑ ููููุฉ ุนูู QR ููุฏ ูู ุณูุฏ ุงูุงุณุชูุงู</p>
        </div>

        <!-- QR Code Test Section -->
        <div class="p-6 card-padding">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 qr-grid">
                <!-- JSON QR Code -->
                <div class="bg-gray-50 rounded-lg border border-gray-200 p-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">QR ููุฏ ุจูุงูุงุช JSON</h3>
                    <div class="bg-white rounded-lg border-2 border-dashed border-gray-300 p-6 text-center">
                        <div id="json-qr-container" class="min-h-[200px] flex items-center justify-center qr-container">
                            <div class="text-gray-500">ุฌุงุฑู ุชุญููู QR ููุฏ...</div>
                        </div>
                        <button onclick="generateJSONQR()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            ุฅูุดุงุก QR ููุฏ JSON
                        </button>
                    </div>
                </div>

                <!-- Text QR Code -->
                <div class="bg-gray-50 rounded-lg border border-gray-200 p-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">QR ููุฏ ูุต ุจุณูุท</h3>
                    <div class="bg-white rounded-lg border-2 border-dashed border-gray-300 p-6 text-center">
                        <div id="text-qr-container" class="min-h-[200px] flex items-center justify-center qr-container">
                            <div class="text-gray-500">ุฌุงุฑู ุชุญููู QR ููุฏ...</div>
                        </div>
                        <button onclick="generateTextQR()" class="mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            ุฅูุดุงุก QR ููุฏ ูุต
                        </button>
                    </div>
                </div>

                <!-- Professional Arabic QR Code -->
                <div class="bg-gray-50 rounded-lg border border-gray-200 p-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">QR ููุฏ ุงุญุชุฑุงูู ููุณู</h3>
                    <div class="bg-white rounded-lg border-2 border-dashed border-gray-300 p-6 text-center">
                        <div id="arabic-qr-container" class="min-h-[200px] flex items-center justify-center qr-container">
                            <div class="text-gray-500">ุฌุงุฑู ุชุญููู QR ููุฏ...</div>
                        </div>
                        <button onclick="generateArabicQR()" class="mt-4 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            ุฅูุดุงุก QR ููุฏ ุงุญุชุฑุงูู
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Preview Section -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
        <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-xl font-semibold text-gray-900">ุจูุงูุงุช QR ููุฏ</h2>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div>
                    <h3 class="text-lg font-medium text-gray-900 mb-3">ุจูุงูุงุช JSON:</h3>
                    <pre id="json-data" class="bg-gray-100 border border-gray-300 rounded-lg p-4 text-xs overflow-auto max-h-80 text-right"></pre>
                </div>
                <div>
                    <h3 class="text-lg font-medium text-gray-900 mb-3">ูุต ุจุณูุท:</h3>
                    <pre id="text-data" class="bg-gray-100 border border-gray-300 rounded-lg p-4 text-xs overflow-auto max-h-80 text-right"></pre>
                </div>
                <div>
                    <h3 class="text-lg font-medium text-gray-900 mb-3">ูุต ุงุญุชุฑุงูู ููุณู:</h3>
                    <pre id="arabic-data" class="bg-gray-100 border border-gray-300 rounded-lg p-4 text-xs overflow-auto max-h-80 text-right"></pre>
                </div>
            </div>
        </div>
    </div>

    <!-- Instructions Section -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
        <h3 class="text-lg font-semibold text-blue-900 mb-4">ููููุฉ ุงูุงุฎุชุจุงุฑ:</h3>
        <ol class="list-decimal list-inside space-y-2 text-blue-800">
            <li>ุงููุฑ ุนูู ุฃุฒุฑุงุฑ "ุฅูุดุงุก QR ููุฏ" ุฃุนูุงู</li>
            <li>ุงูุณุญ QR ููุฏ ุจุงุณุชุฎุฏุงู ุชุทุจูู ูุงุฑุฆ QR ุนูู ูุงุชูู</li>
            <li>ุชุญูู ูู ุฃู ุงูุจูุงูุงุช ุงููุนุฑูุถุฉ ุชุญุชูู ุนูู ูุนูููุงุช ุณูุฏ ุงูุงุณุชูุงู ูููุณ ุฑุงุจุท ุงููููุน</li>
            <li>QR ููุฏ JSON ูุญุชูู ุนูู ุจูุงูุงุช ููุตูุฉุ ุจูููุง QR ููุฏ ุงููุต ูุญุชูู ุนูู ูุนูููุงุช ูุจุณุทุฉ</li>
        </ol>
    </div>

    <!-- Sample Receipt Link -->
    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6">
        <h3 class="text-lg font-semibold text-yellow-900 mb-3">ูุงุฎุชุจุงุฑ ุณูุฏ ุงุณุชูุงู ุญูููู:</h3>
        <p class="text-yellow-800 mb-2">ุชุญุชุงุฌ ุฃููุงู ูุฅูุดุงุก ูุงุชูุฑุฉ ูุฏูุนุฉ ูู ุงููุธุงูุ ุซู ููููู ุงููุตูู ูุณูุฏ ุงูุงุณุชูุงู ุนุจุฑ:</p>
        <code class="bg-yellow-100 text-yellow-900 px-2 py-1 rounded text-sm">/tenant/receipts/payment/{payment_id}/web</code>
    </div>
</div>
@endsection

@push('scripts')
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
<style>
/* Additional responsive styles */
@media (max-width: 1024px) {
    .grid-cols-1.lg\\:grid-cols-3 {
        grid-template-columns: repeat(1, minmax(0, 1fr));
    }
}

@media (max-width: 768px) {
    .qr-grid {
        gap: 1rem;
    }

    .qr-container {
        min-height: 150px;
    }

    pre {
        font-size: 10px;
        max-height: 200px;
    }
}

@media (max-width: 480px) {
    .main-container {
        padding-left: 1rem;
        padding-right: 1rem;
    }

    .card-padding {
        padding: 1rem;
    }

    .header-padding {
        padding: 1rem;
    }
}
</style>
<script>
// Sample receipt data for testing
var sampleReceiptData = {
    type: 'payment_receipt',
    receipt_number: 'RCPT-2024-0001',
    payment_id: 123,
    invoice_id: 456,
    invoice_number: 'INV-2024-0001',
    tenant: 'ุดุฑูุฉ ูุงูุณ ููู ููุฃุฏููุฉ',
    customer: 'ุตูุฏููุฉ ุงูุดูุงุก',
    sales_rep: 'ุฃุญูุฏ ูุญูุฏ',
    amount: 150000,
    currency: 'IQD',
    payment_method: 'ููุฏุงู',
    payment_date: '2024-01-15',
    generated_at: new Date().toISOString(),
    note: 'ุณูุฏ ุงุณุชูุงู ุตุงุฏุฑ ูู ูุธุงู ูุงูุณ ููู ููุฅุฏุงุฑุฉ ุงูุตูุฏูุงููุฉ'
};

var sampleTextData = `ุณูุฏ ุงุณุชูุงู
ุฑูู ุงูุณูุฏ: RCPT-2024-0001
ุฑูู ุงููุงุชูุฑุฉ: INV-2024-0001
ุงูุนููู: ุตูุฏููุฉ ุงูุดูุงุก
ุงููุจูุบ ุงููุณุชูู: 150,000.00 ุฏ.ุน
ุทุฑููุฉ ุงูุฏูุน: ููุฏุงู
ุงูุชุงุฑูุฎ: 2024-01-15
ุงูุดุฑูุฉ: ุดุฑูุฉ ูุงูุณ ููู ููุฃุฏููุฉ
ุงูููุฏูุจ: ุฃุญูุฏ ูุญูุฏ`;

var sampleArabicData = `๐งพ ุณูุฏ ุงุณุชูุงู
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ ุฑูู ุงูุณูุฏ: RCPT-2024-0001
๐ ุฑูู ุงููุงุชูุฑุฉ: INV-2024-0001
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ข ุงูุดุฑูุฉ: ุดุฑูุฉ ูุงูุณ ููู ููุฃุฏููุฉ
๐ค ุงูุนููู: ุตูุฏููุฉ ุงูุดูุงุก
๐จโ๐ผ ุงูููุฏูุจ: ุฃุญูุฏ ูุญูุฏ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ฐ ุงููุจูุบ ุงููุณุชูู: 150,000.00 ุฏ.ุน
๐ณ ุทุฑููุฉ ุงูุฏูุน: ููุฏุงู
๐ ุงูุชุงุฑูุฎ: 2024-01-15
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุชู ุงูุงุณุชูุงู ุจูุฌุงุญ
๐ ูุตุฏู ูู ูุธุงู ูุงูุณ ููู`;

function generateJSONQR() {
    var container = document.getElementById('json-qr-container');
    var dataContainer = document.getElementById('json-data');
    
    container.innerHTML = '<div class="text-muted">ุฌุงุฑู ุฅูุดุงุก QR ููุฏ...</div>';
    
    var jsonString = JSON.stringify(sampleReceiptData, null, 2);
    dataContainer.textContent = jsonString;
    
    // Try using qrcode.js library
    if (typeof QRCode !== 'undefined' && QRCode.toCanvas) {
        var canvas = document.createElement('canvas');
        QRCode.toCanvas(canvas, JSON.stringify(sampleReceiptData), {
            width: 200,
            height: 200,
            margin: 2,
            color: {
                dark: '#2d3748',
                light: '#ffffff'
            }
        }, function (error) {
            if (error) {
                console.error('Error generating QR code:', error);
                fallbackQR(container, JSON.stringify(sampleReceiptData));
                return;
            }
            
            container.innerHTML = '';
            container.appendChild(canvas);

            var desc = document.createElement('div');
            desc.className = 'text-gray-600 mt-3 text-sm';
            desc.textContent = 'QR ููุฏ ูุญุชูู ุนูู ุจูุงูุงุช JSON ูุงููุฉ';
            container.appendChild(desc);
        });
    } else {
        fallbackQR(container, JSON.stringify(sampleReceiptData));
    }
}

function generateTextQR() {
    var container = document.getElementById('text-qr-container');
    var dataContainer = document.getElementById('text-data');
    
    container.innerHTML = '<div class="text-muted">ุฌุงุฑู ุฅูุดุงุก QR ููุฏ...</div>';
    dataContainer.textContent = sampleTextData;
    
    // Try using qrcode.js library
    if (typeof QRCode !== 'undefined' && QRCode.toCanvas) {
        var canvas = document.createElement('canvas');
        QRCode.toCanvas(canvas, sampleTextData, {
            width: 200,
            height: 200,
            margin: 2,
            color: {
                dark: '#2d3748',
                light: '#ffffff'
            }
        }, function (error) {
            if (error) {
                console.error('Error generating QR code:', error);
                fallbackQR(container, sampleTextData);
                return;
            }
            
            container.innerHTML = '';
            container.appendChild(canvas);

            var desc = document.createElement('div');
            desc.className = 'text-gray-600 mt-3 text-sm';
            desc.textContent = 'QR ููุฏ ูุญุชูู ุนูู ูุต ุจุณูุท ููุฑูุก';
            container.appendChild(desc);
        });
    } else {
        fallbackQR(container, sampleTextData);
    }
}

function generateArabicQR() {
    var container = document.getElementById('arabic-qr-container');
    var dataContainer = document.getElementById('arabic-data');

    container.innerHTML = '<div class="text-gray-500">ุฌุงุฑู ุฅูุดุงุก QR ููุฏ...</div>';
    dataContainer.textContent = sampleArabicData;

    // Try using qrcode.js library
    if (typeof QRCode !== 'undefined' && QRCode.toCanvas) {
        var canvas = document.createElement('canvas');
        QRCode.toCanvas(canvas, sampleArabicData, {
            width: 200,
            height: 200,
            margin: 2,
            color: {
                dark: '#2d3748',
                light: '#ffffff'
            }
        }, function (error) {
            if (error) {
                console.error('Error generating QR code:', error);
                fallbackQR(container, sampleArabicData);
                return;
            }

            container.innerHTML = '';
            container.appendChild(canvas);

            var desc = document.createElement('div');
            desc.className = 'text-gray-600 mt-3 text-sm';
            desc.textContent = 'QR ููุฏ ุงุญุชุฑุงูู ููุณู ูุน ุฑููุฒ ุชุนุจูุฑูุฉ';
            container.appendChild(desc);
        });
    } else {
        fallbackQR(container, sampleArabicData);
    }
}

function fallbackQR(container, data) {
    var img = document.createElement('img');
    img.src = 'https://api.qrserver.com/v1/create-qr-code/?size=200x200&format=png&data=' + encodeURIComponent(data);
    img.style.cssText = 'width:200px; height:200px; border:1px solid #e5e7eb;';
    img.onload = function() {
        container.innerHTML = '';
        container.appendChild(img);

        var desc = document.createElement('div');
        desc.className = 'text-gray-600 mt-3 text-sm';
        desc.textContent = 'QR ููุฏ ุชู ุฅูุดุงุคู ุนุจุฑ External API';
        container.appendChild(desc);
    };
    img.onerror = function() {
        container.innerHTML = '<div class="text-red-600 text-sm">ูุดู ูู ุฅูุดุงุก QR ููุฏ</div>';
    };
}

// Auto-generate on page load
document.addEventListener('DOMContentLoaded', function() {
    generateJSONQR();
    generateTextQR();
    generateArabicQR();
});
</script>
@endpush
